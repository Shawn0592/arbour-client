var MAP = {
	"A1": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"A2": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"A3": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"A4": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"A5": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"A6": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"A7": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"A8": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"A9": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"B1": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"B2": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"B3": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"B4": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"B5": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"B6": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"B7": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"B8": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"B9": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"C1": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null}, 
	"C2": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"C3": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"C4": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"C5": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"C6": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"C7": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"C8": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"C9": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"D1": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"D2": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"D3": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"D4": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"D5": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"D6": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"D7": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"D8": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"D9": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"E1": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"E2": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"E3": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"E4": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"E5": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"E6": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"E7": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"E8": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"E9": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"F1": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"F2": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"F3": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"F4": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"F5": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"F6": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"F7": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null},
	"F8": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null}, 
	"F9": {"movable": true, "tile":0, "hero":false, "hero_by_player":null, "hero_number": null}
};

var trees, mountains = 0;

for(var i = 1; i <= 6; i++){
	for(var k = 1; k <= 9; k++){
		if(trees < 10 || mountains < 10){
			var tree = random(1,6);
			var mountain = random(1,6);

			var row = '';
			if(i == 1){ row = 'A'; } else if(i == 2){ row = 'B'; } else if(i == 3){ row = 'C'; } else if(i == 4){ row = 'D'; } else if(i == 5){ row = 'E'; } else if(i == 6){ row = 'F'; }

			if(tree == true && mountain == false){
				trees = trees + 1;
				MAP[row+k].movable = false;
				MAP[row+k].tile = '1_'+randomInteger(1,3);
			} else if(tree == false && mountain == true){
				mountains = mountains + 1;
				MAP[row+k].movable = false;
				MAP[row+k].tile = '2_'+randomInteger(1,3);
			}
		}
	}
}

function map_click(tile){
	if(tutorial_mode == false){
		if($('#judge-game').css('display') != 'none') return;

		if(GAME_MENUS.key_Q == true){
			if(MAP[tile].movable == false && MAP[tile].tile != 0){
				$('#for-'+tile).css('opacity','0');
				MAP[tile].movable = true;
				MAP[tile].tile = 0;
				$('#'+tile).removeClass('map-blocked-item');

				// var x, y;
				// x = document.getElementById(tile).transform.animVal[0].matrix.e+13;
				// y = document.getElementById(tile).transform.animVal[0].matrix.f+27;

				// document.getElementsByTagName('svg')[0].innerHTML = document.getElementsByTagName('svg')[0].innerHTML + `
				// 	<text x="`+x+`" y="`+y+`" style="fill:rgb(186, 196, 164);font-weight:400;font-size:12px;" class="map-text">`+tile+`</text>`;
				document.getElementById(tile).href.baseVal = 'assets/map/tile0.png';
				
				$('#'+tile).addClass('map-item');
				hide_buttons();
				GAME_MENUS.key_Q = false;
				used_q = true;

				for(var i in MAP){
					$('#'+i).css('opacity','1');
				}

				show_buttons();
				sync();
			}
		} else if(hero_chosed == true && hero_chose != null){
			if($('#'+tile).css('opacity') == '1'){
				var x, y;
				x = document.getElementById(tile).transform.animVal[0].matrix.e+8;
				y = document.getElementById(tile).transform.animVal[0].matrix.f+11.5;

				document.getElementsByTagName('svg')[0].innerHTML = document.getElementsByTagName('svg')[0].innerHTML + '<image overflow="visible" id="hero-'+tile+'-'+hero_chose+'" width="100" height="100" xlink:href="assets/map/player1.png" style="pointer-events:none;" transform="matrix(0.24 0 0 0.24 '+x+' '+y+')">';

				$('#hero-'+hero_chose).css('display','none');
				MAP[tile].hero = true;
				MAP[tile].movable = false;
				MAP[tile].hero_by_player = my_key;
				MAP[tile].heroType = hero_chose;
				MAP[tile].hero_number = heroes-1;

				  for(var i in MAP){
				    if(MAP[i].movable == false){
				      $('#'+i).css('opacity','1');
				    }
				  }

				show_buttons();
				hero_chosed = false;
				hero_chose = null;
				sync();

			    if(heroes == 1){
			        $('#judge-game').css('opacity','0');
			        $('#judge-game').css('display','block');
			        $('#judge-game').css('opacity','1');
			        setTimeout(function(){
			          $("#judge-text-game").typed({
			            strings: [`Отличный выбор!^1500 Теперь размести своего второго героя на игровое поле.`],
			            stringsElement: null,
			            typeSpeed: 40,
			            startDelay: 1200,
			            backSpeed: 20,
			            backDelay: 500,
			            loop: false,
			            loopCount: 0,
			            showCursor: false,
			            cursorChar: "|",
			            attr: null,
			            contentType: 'html',
			            onStringTyped: function() {
			              setTimeout(function(){
			                tutorial_step = i+1;
			                $('#judge-game').css('opacity','0');
			                setTimeout(function(){
			                  $('#judge-game').css('display','none');
			                  $('#judge-text-game').typed('reset'); $('#judge-text-game').text('...');
			                }, 500);
			              }, 5000);
			            }
			          });
			        }, 500);
			    } else if(heroes == 2){
			        $('#judge-game').css('opacity','0');
			        $('#judge-game').css('display','block');
			        $('#judge-game').css('opacity','1');
			        setTimeout(function(){
			          $("#judge-text-game").typed({
			            strings: [`Я думаю,^1000 с такой командой ты точно победишь!^1500 Теперь размести своего третьего героя на игровое поле.`],
			            stringsElement: null,
			            typeSpeed: 40,
			            startDelay: 1200,
			            backSpeed: 20,
			            backDelay: 500,
			            loop: false,
			            loopCount: 0,
			            showCursor: false,
			            cursorChar: "|",
			            attr: null,
			            contentType: 'html',
			            onStringTyped: function() {
			              setTimeout(function(){
			                $('#judge-game').css('opacity','0');
			                setTimeout(function(){
			                  $('#judge-game').css('display','none');
			                  $('#judge-text-game').typed('reset'); $('#judge-text-game').text('...');
			                }, 500);
			              }, 5000);
			            }
			          });
			        }, 500);
			    } else if(heroes == 3){
			        $('#judge-game').css('opacity','0');
			        $('#judge-game').css('display','block');
			        $('#judge-game').css('opacity','1');
			        setTimeout(function(){
			          $("#judge-text-game").typed({
			            strings: [`Все герои размещены на карте.^1500 Теперь я даю тебе возможность управлять своими героями.^1500 Удачи!`],
			            stringsElement: null,
			            typeSpeed: 40,
			            startDelay: 1200,
			            backSpeed: 20,
			            backDelay: 500,
			            loop: false,
			            loopCount: 0,
			            showCursor: false,
			            cursorChar: "|",
			            attr: null,
			            contentType: 'html',
			            onStringTyped: function() {
			              setTimeout(function(){
			                $('#judge-game').css('opacity','0');
			                setTimeout(function(){
			                  $('#judge-game').css('display','none');
			                  $('#judge-text-game').typed('reset'); $('#judge-text-game').text('...');
			                }, 500);
			              }, 5000);
			            }
			          });
			        }, 500);

				    if(enemy_heroes.length != 3){
				        $('#judge-game').css('opacity','0');
				        $('#judge-game').css('display','block');
				        $('#judge-game').css('opacity','1');
						
						$("#judge-text-game").typed({
							strings: [`Ожидаем второго игрока..`],
							stringsElement: null,
							typeSpeed: 40,
							startDelay: 1200,
							backSpeed: 20,
							backDelay: 500,
							loop: false,
							loopCount: 0,
							showCursor: false,
							cursorChar: "|",
							attr: null,
							contentType: 'html',
							onStringTyped: function() {}
						});

						var checker = setInterval(function(){
							if(enemy_heroes.length == 3){
								clearInterval(checker);
								$('#judge-game').css('opacity','0');
								setTimeout(function(){
									$('#judge-game').css('display','none');
									$('#judge-text-game').typed('reset'); $('#judge-text-game').text('...');
								}, 500);
							}
						}, 2000);
					}
			    }
			}
		} else if(MAP[tile].hero == true && _hero_chosed_tile == false){
			_hero_chosed = true;
			_hero_chosed_tile = tile;

			$('.heroes').css('left','-100px');
			$('.heroes .info').css('left','0px');

			$('.heroes').css('opacity','0');
	      	$('.heroes').css('pointer-events','none');
			$('.heroes .info').css('opacity','0');
			GAME_MENUS.key_C = false;

	  		document.getElementsByClassName('block')[0].style.bottom = '-60px';
	  		drawMenu(HEROES[MAP[tile].heroType-1].type);
			if(MAP[tile].hero_by_player == my_key) show_buttons();

			$('.hero-stats').css('left','10px');
			var stats = document.getElementsByClassName('stat');
			for(var i in stats){
				if(HEROES[MAP[tile].heroType-1].rare == false){
					document.getElementById('stats-header').innerHTML = `<div>${HEROES[MAP[tile].heroType-1].name} 
						<img id="stats-img" src="assets/img/${HEROES[MAP[tile].heroType-1].type}.svg" width="16" height="16"></div>
						<div>1 уровень</div>
						<div>Обычный</div>`;
				} else {
					document.getElementById('stats-header').innerHTML = `<div>${HEROES[MAP[tile].heroType-1].name} 
						<img id="stats-img" src="assets/img/${HEROES[MAP[tile].heroType-1].type}.svg" width="16" height="16"></div>
						<div>1 уровень</div>
						<div class="rare">Редкий</div>`;
				}
				document.getElementsByClassName('stat-value')[i].innerHTML = HEROES[MAP[tile].heroType-1].params[i];
			}

			for(var i in MAP){
				if(i != tile) $('#'+i).css('opacity','.2');
			}

			document.getElementById(tile).href.baseVal = 'assets/map/tile0_1.png';
			$('#'+tile).css('z-index','1000');
		} else if(MAP[tile].hero == true && _hero_chosed_tile == tile){
			_hero_chosed = false;
			_hero_chosed_tile = '';

			if(heroes < 3 && _hero_chosed == false)
	  			document.getElementsByClassName('block')[0].style.bottom = '10px';

			document.getElementsByClassName('block')[1].style.bottom = '-60px';
			document.getElementsByClassName('block')[2].style.bottom = '-60px';
			document.getElementsByClassName('block')[3].style.bottom = '-60px';
			document.getElementsByClassName('block')[4].style.bottom = '-60px';
			document.getElementsByClassName('block')[5].style.bottom = '-60px';
			document.getElementsByClassName('block')[6].style.bottom = '-60px';

			document.getElementsByClassName('block')[8].style.bottom = '-60px';
			document.getElementsByClassName('block')[9].style.bottom = '-60px';

			document.getElementsByClassName('block')[10].style.bottom = '-60px';

			$('.hero-stats').css('left','-300px');
			document.getElementById(tile).href.baseVal = 'assets/map/tile0.png';
			$('#'+tile).css('z-index','1');

			for(var i in MAP){
				$('#'+i).css('opacity','1');
			}
		} else if(_hero_move == true){
			if(_hero_chosed_tile == tile) return;

			if($('#'+tile).css('opacity') == '1'){
				MAP[_hero_chosed_tile].hero = false;
				MAP[_hero_chosed_tile].movable = true;
				MAP[tile].hero_number = MAP[_hero_chosed_tile].hero_number;
				MAP[tile].hero_by_player = MAP[_hero_chosed_tile].hero_by_player;
				MAP[tile].heroType = MAP[_hero_chosed_tile].heroType;
				document.getElementById(_hero_chosed_tile).href.baseVal = 'assets/map/tile0.png';

				MAP[tile].hero = true;
				MAP[tile].movable = false;
				MAP[_hero_chosed_tile].heroType = null;
				MAP[_hero_chosed_tile].hero_by_player = null;
				MAP[_hero_chosed_tile].hero_number = null;
				document.getElementById(tile).href.baseVal = 'assets/map/tile0_1.png';

				_hero_move = false;
				for(var i in MAP){
					if(i != tile)
						$('#'+i).css('opacity', '0.2');
				}
				GAME_MENUS.key_M = false; 			

				document.getElementById('hero-'+_hero_chosed_tile+'-'+MAP[tile].heroType).remove();
				_hero_chosed_tile = tile;

				var x, y;
				x = document.getElementById(tile).transform.animVal[0].matrix.e+9;
				y = document.getElementById(tile).transform.animVal[0].matrix.f+11.5;

				document.getElementsByTagName('svg')[0].innerHTML = document.getElementsByTagName('svg')[0].innerHTML + '<image overflow="visible" width="100" id="hero-'+tile+'-'+MAP[tile].heroType+'" height="100" xlink:href="assets/map/player1.png" style="pointer-events:none;" transform="matrix(0.24 0 0 0.24 '+x+' '+y+')">';

				sync();
				show_buttons();
			}
		}
	} else {
		if(TUTORIAL_MENUS.key_Q == true){
			if(TUTORIAL_MAP[tile].movable == false && TUTORIAL_MAP[tile].tile != 0){
				$('#for-'+tile).css('opacity','0');
				TUTORIAL_MAP[tile].movable = true;
				TUTORIAL_MAP[tile].tile = 0;
				$('#tutorial-'+tile).removeClass('map-blocked-item');

				// var x, y;
				// x = document.getElementById(tile).transform.animVal[0].matrix.e+13;
				// y = document.getElementById(tile).transform.animVal[0].matrix.f+27;

				// document.getElementsByTagName('svg')[0].innerHTML = document.getElementsByTagName('svg')[0].innerHTML + `
				// 	<text x="`+x+`" y="`+y+`" style="fill:rgb(186, 196, 164);font-weight:400;font-size:12px;" class="map-text">`+tile+`</text>`;
				document.getElementById("tutorial-"+tile).href.baseVal = 'assets/map/tile0.png';
				
				$('#tutorial-'+tile).addClass('map-item');
				TUTORIAL_MENUS.key_Q = false;
				document.getElementsByClassName('block-tutorial')[7].style.bottom = '-60px'; // Q

				for(var i in TUTORIAL_MAP){
					$('#tutorial-'+i).css('opacity','1');
				}

				setTimeout(function(){
					$('#judge').css('opacity','0');
					$('#judge').css('display','block');
					$('#judge').css('opacity','1');
					setTimeout(function(){
						tutorial(tutorial_step)
					}, 500);
				}, 2000);
			}
		} else if(hero_chosed == true && hero_chose != null){
			if($('#tutorial-'+tile).css('opacity') == '1' && MAP[tile].movable == true){
				var x, y;
				x = document.getElementById('tutorial-'+tile).transform.animVal[0].matrix.e+8;
				y = document.getElementById('tutorial-'+tile).transform.animVal[0].matrix.f+11.5;

				document.getElementsByTagName('svg')[1].innerHTML = document.getElementsByTagName('svg')[1].innerHTML + '<image overflow="visible" id="hero-'+tile+'-'+hero_chose+'" width="100" height="100" xlink:href="assets/map/player1.png" style="pointer-events:none;" transform="matrix(0.24 0 0 0.24 '+x+' '+y+')">';

				$('#hero-'+hero_chose).css('display','none');
				TUTORIAL_MAP[tile].hero = true;
				TUTORIAL_MAP[tile].movable = false;
				TUTORIAL_MAP[tile].hero_by_player = 'tutorial';
				TUTORIAL_MAP[tile].heroType = hero_chose;
				TUTORIAL_MAP[tile].hero_number = heroes-1;

				for(var i in TUTORIAL_MAP){
					if(TUTORIAL_MAP[i].movable == false){
						$('#tutorial-'+i).css('opacity','1');
					}
				}

				$('#judge').css('opacity','0');
				$('#judge').css('display','block');
				$('#judge').css('opacity','1');
				setTimeout(function(){
					tutorial(tutorial_step);
				}, 500);
				hero_chosed = false;
				hero_chose = null;
			}
		} else if(TUTORIAL_MAP[tile].hero == true && _hero_chosed_tile == false){
			_hero_chosed = true;
			_hero_chosed_tile = tile;

			$('.heroes-tutorial').css('left','-100px');
			$('.heroes-tutorial .info').css('left','0px');

			$('.heroes-tutorial').css('opacity','0');
	      	$('.heroes-tutorial').css('pointer-events','none');
			$('.heroes-tutorial .info').css('opacity','0');
			TUTORIAL_MENUS.key_C = false;

	  		document.getElementsByClassName('block-tutorial')[0].style.bottom = '-60px';
	  		//drawTutorialMenu(HEROES[TUTORIAL_MAP[tile].heroType-1].type);
			if(TUTORIAL_MAP[tile].hero_by_player == my_key) show_buttons();

			$('.hero-stats-tutorial').css('left','10px');
			var stats = document.getElementsByClassName('stat-tutorial');
			for(var i in stats){
				if(HEROES[TUTORIAL_MAP[tile].heroType-1].rare == false){
					document.getElementById('stats-header-tutorial').innerHTML = `<div>${HEROES[TUTORIAL_MAP[tile].heroType-1].name} 
						<img id="stats-img" src="assets/img/${HEROES[TUTORIAL_MAP[tile].heroType-1].type}.svg" width="16" height="16"></div>
						<div>1 уровень</div>
						<div>Обычный</div>`;
				} else {
					document.getElementById('stats-header-tutorial').innerHTML = `<div>${HEROES[TUTORIAL_MAP[tile].heroType-1].name} 
						<img id="stats-img" src="assets/img/${HEROES[TUTORIAL_MAP[tile].heroType-1].type}.svg" width="16" height="16"></div>
						<div>1 уровень</div>
						<div class="rare">Редкий</div>`;
				}
				document.getElementsByClassName('stat-value-tutorial')[i].innerHTML = HEROES[TUTORIAL_MAP[tile].heroType-1].params[i];
			}

			for(var i in TUTORIAL_MAP){
				if(i != tile) $('#tutorial-'+i).css('opacity','.2');
			}

			document.getElementById('tutorial-'+tile).href.baseVal = 'assets/map/tile0_1.png';
			$('#tutorial-'+tile).css('z-index','1000');

			setTimeout(function(){
				$('#judge').css('opacity','0');
				$('#judge').css('display','block');
				$('#judge').css('opacity','1');
				setTimeout(function(){
					tutorial(tutorial_step);
				}, 500);
			}, 5000);
		} else if(_hero_move == true){
			if(_hero_chosed_tile == tile) return;

			if($('#tutorial-'+tile).css('opacity') == '1'){
				TUTORIAL_MAP[_hero_chosed_tile].hero = false;
				TUTORIAL_MAP[_hero_chosed_tile].movable = true;
				TUTORIAL_MAP[tile].hero_number = TUTORIAL_MAP[_hero_chosed_tile].hero_number;
				TUTORIAL_MAP[tile].hero_by_player = TUTORIAL_MAP[_hero_chosed_tile].hero_by_player;
				TUTORIAL_MAP[tile].heroType = TUTORIAL_MAP[_hero_chosed_tile].heroType;
				document.getElementById('tutorial-'+_hero_chosed_tile).href.baseVal = 'assets/map/tile0.png';

				TUTORIAL_MAP[tile].hero = true;
				TUTORIAL_MAP[tile].movable = false;
				TUTORIAL_MAP[_hero_chosed_tile].heroType = null;
				TUTORIAL_MAP[_hero_chosed_tile].hero_by_player = null;
				TUTORIAL_MAP[_hero_chosed_tile].hero_number = null;
				document.getElementById('tutorial-'+tile).href.baseVal = 'assets/map/tile0_1.png';

				_hero_move = false;
				for(var i in TUTORIAL_MAP){
					if(i != tile)
						$('#tutorial-'+i).css('opacity', '0.2');
				}
				TUTORIAL_MENUS.key_M = false; 			

				document.getElementById('hero-'+_hero_chosed_tile+'-'+TUTORIAL_MAP[tile].heroType).remove();
				_hero_chosed_tile = tile;

				var x, y;
				x = document.getElementById('tutorial-'+tile).transform.animVal[0].matrix.e+9;
				y = document.getElementById('tutorial-'+tile).transform.animVal[0].matrix.f+11.5;
				document.getElementsByTagName('svg')[1].innerHTML = document.getElementsByTagName('svg')[1].innerHTML + '<image overflow="visible" width="100" id="hero-'+tile+'-'+TUTORIAL_MAP[tile].heroType+'" height="100" xlink:href="assets/map/player1.png" style="pointer-events:none;" transform="matrix(0.24 0 0 0.24 '+x+' '+y+')">';

				document.getElementsByClassName('block-tutorial')[10].style.bottom = '-60px'; // M
				setTimeout(function(){
					$('#judge').css('opacity','0');
					$('#judge').css('display','block');
					$('#judge').css('opacity','1');
					setTimeout(function(){
						tutorial(tutorial_step);
					}, 500);
				}, 5000);
			}
		}
	}
}

function drawMap(param){
	var row, col, _row;

	var opacities = [];
	for(var i in MAP){
		opacities.push({
			tile: i,
			opacity: $('#'+i).css('opacity')
		})
	}

	if(_hero_chosed_tile == deletedHeroTile){
		_hero_chosed = false;
		_hero_chosed_tile = '';

		if(heroes < 3 && _hero_chosed == false)
  			document.getElementsByClassName('block')[0].style.bottom = '10px';

		document.getElementsByClassName('block')[1].style.bottom = '-60px';
		document.getElementsByClassName('block')[2].style.bottom = '-60px';
		document.getElementsByClassName('block')[3].style.bottom = '-60px';
		document.getElementsByClassName('block')[4].style.bottom = '-60px';
		document.getElementsByClassName('block')[5].style.bottom = '-60px';
		document.getElementsByClassName('block')[6].style.bottom = '-60px';

		document.getElementsByClassName('block')[8].style.bottom = '-60px';
		document.getElementsByClassName('block')[9].style.bottom = '-60px';

		document.getElementsByClassName('block')[10].style.bottom = '-60px';

		$('.hero-stats').css('left','-300px');
		document.getElementById(deletedHeroTile).href.baseVal = 'assets/map/tile0.png';
		$('#'+deletedHeroTile).css('z-index','1');

		for(var i in opacities){
			opacities[i].opacity = 1;
		}

		deletedHeroTile = null;
	} else if(_hero_chosed_tile && !MAP[_hero_chosed_tile].hero){
		_hero_chosed = false;
		deletedHeroTile = _hero_chosed_tile;
		_hero_chosed_tile = '';
		_hero_move = false;

		if(heroes < 3 && _hero_chosed == false)
  			document.getElementsByClassName('block')[0].style.bottom = '10px';

		document.getElementsByClassName('block')[1].style.bottom = '-60px';
		document.getElementsByClassName('block')[2].style.bottom = '-60px';
		document.getElementsByClassName('block')[3].style.bottom = '-60px';
		document.getElementsByClassName('block')[4].style.bottom = '-60px';
		document.getElementsByClassName('block')[5].style.bottom = '-60px';
		document.getElementsByClassName('block')[6].style.bottom = '-60px';

		document.getElementsByClassName('block')[8].style.bottom = '-60px';
		document.getElementsByClassName('block')[9].style.bottom = '-60px';

		document.getElementsByClassName('block')[10].style.bottom = '-60px';

		$('.hero-stats').css('left','-300px');
		document.getElementById(deletedHeroTile).href.baseVal = 'assets/map/tile0.png';
		$('#'+deletedHeroTile).css('z-index','1');

		for(var i in opacities){
			opacities[i].opacity = 1;
		}

		deletedHeroTile = null;
	}

	document.getElementsByTagName('svg')[0].innerHTML = ``;

	for(var i in MAP){
		row = i[0];
		if(row == 'A'){ _row = 1; } else if(row == 'B'){ _row = 2; } else if(row == 'C'){ _row = 3; } else if(row == 'D'){ _row = 4; } else if(row == 'E'){ _row = 5; } else if(row == 'F'){ _row = 6; }
		col = i[1];
		var _x = 38;
		var del_x = 0;
		var y = (_row*34)+35;

		var x = (col*_x)-35;

		if(row == 'B' || row == 'D' || row == 'F'){
			del_x = 21.5;
			x = ((col*_x)+del_x)-38;
		}

		document.getElementsByTagName('svg')[0].innerHTML = document.getElementsByTagName('svg')[0].innerHTML + `<image overflow="visible" width="613" height="718" id="`+i+`" onclick="map_click('`+i+`')" xlink:href="assets/map/tile`+MAP[i].tile+`.png" transform="matrix(0.0655 0 0 0.0655 `+x+` `+y+`)">
			</image>`;
	
		if(MAP[i].hero){
			var x, y;
			x = document.getElementById(i).transform.animVal[0].matrix.e+9;
			y = document.getElementById(i).transform.animVal[0].matrix.f+11.5;

			if(MAP[i].hero_by_player == my_key){
				document.getElementsByTagName('svg')[0].innerHTML = document.getElementsByTagName('svg')[0].innerHTML + '<image overflow="visible" width="100" id="hero-'+i+'-'+MAP[i].heroType+'" height="100" xlink:href="assets/map/player1.png" style="pointer-events:none;" transform="matrix(0.24 0 0 0.24 '+x+' '+y+')">';
			} else {
				document.getElementsByTagName('svg')[0].innerHTML = document.getElementsByTagName('svg')[0].innerHTML + '<image overflow="visible" width="100" id="hero-'+i+'-'+MAP[i].heroType+'" height="100" xlink:href="assets/map/player2.png" style="pointer-events:none;" transform="matrix(0.24 0 0 0.24 '+x+' '+y+')">';
			}
		}
	}

	for(var i in MAP){
		if(MAP[i].movable == false){
			document.getElementById(i).href.baseVal = 'assets/map/tile'+MAP[i].tile+'.png';
			$('#'+i).addClass('map-blocked-item');
		} else if(MAP[i].movable == true && MAP[i].tile == 0){
			// var x, y;
			// x = document.getElementById(i).transform.animVal[0].matrix.e+13;
			// y = document.getElementById(i).transform.animVal[0].matrix.f+27;

			// document.getElementsByTagName('svg')[0].innerHTML = document.getElementsByTagName('svg')[0].innerHTML + `
			// 	<text x="`+x+`" y="`+y+`" style="fill:#C3B58D;font-weight:400;font-size:12px;" class="map-text">`+i+`</text>`;
			
			$('#'+i).addClass('map-item');
		}
	}

	for(var i in opacities){
		$('#'+opacities[i].tile).css('opacity', opacities[i].opacity);
	}

	if(_hero_chosed_tile){
		if(MAP[_hero_chosed_tile].hero == false){
			for(var i in MAP){
				if(MAP[i].heroType == _hero_type && MAP[i].hero == true && MAP[i].hero_by_player == enemy_key){
					$('#'+_hero_chosed_tile).css('opacity', '0.2');
					_hero_chosed_tile = i;
					$('#'+i).css('opacity', '1');
					document.getElementById(i).href.baseVal = 'assets/map/tile0_1.png';
				}
			}
		} else {
			document.getElementById(_hero_chosed_tile).href.baseVal = 'assets/map/tile0_1.png';
		}
	}

	_hero_type = null;
}

function getMapCollision(r1, r2) {
	var r1 = r1.getBoundingClientRect();
	var r2 = r2.getBoundingClientRect();

	return !(r2.left > r1.right ||
			r2.right < r1.left ||
			r2.top > r1.bottom ||
			r2.bottom < r1.top);
}